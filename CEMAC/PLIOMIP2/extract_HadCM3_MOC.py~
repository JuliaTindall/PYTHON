#!/usr/bin/env python2
# -*- coding: utf-8 -*-

#Created on Thu Mar 18 14:13:50 2019

#@author: earjcti
#
# This program will extract the fields needed by Zhongshi Zhang for the
# PlioMIP MOC paper.  It will extract the monthly averages from
# steve hunters processed data 
#
#
#

import os
import numpy as np
import scipy as sp
#import cf
import iris
import matplotlib as mp
import matplotlib.pyplot as plt
from mpl_toolkits.axes_grid1 import make_axes_locatable
import netCDF4
from netCDF4 import Dataset, MFDataset
from matplotlib.colors import ListedColormap, LinearSegmentedColormap
import iris.analysis.cartography
import sys

#####################################
def extract_fields(filename,fieldnames,fileoutstart,filefieldnames):

    # load required cubes
    cubes=iris.load_cubes(filename,fieldnames)
    
    for i in range(0,len(fieldnames)):
        fileout=fileoutstart+filefieldnames[i]+'.nc'
        if filefieldnames[i]=='SSS':
            subcube=cubes[i]
            cube_extract= subcube.extract(iris.Constraint(z2=5))
            iris.save(cube_extract,fileout,netcdf_format='NETCDF3_CLASSIC',fill_value=2.0E20)
        else:
            iris.save(cubes[i],fileout,netcdf_format='NETCDF3_CLASSIC',fill_value=2.0E20)
     
    
   

##########################################################
# main program

# this is regridding where all results are in a single file

fieldnames=['OCN TOP-LEVEL TEMPERATURE K',
            'SALINITY (OCEAN) (PSU)',
            'AICE : ICE CONCENTRATION']
filefieldnames=['SST','SSS','iceconc']
filename='C:\\Users\\julia\\OneDrive\\DATA\\HadCM3_DATA\\Eoi400_2400-2499_Monthly.nc'
fileoutstart='C:\\Users\\julia\\OneDrive\\DATA\\HadCM3_DATA\\EOI400_2400_2499_Monthly_'
extract_fields(filename,fieldnames,fileoutstart,filefieldnames)

#sys.exit(0)