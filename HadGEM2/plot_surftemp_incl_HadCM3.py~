#!/usr/bin/env python2.7
#NAME
#    PLOT_SURFTEMP
#PURPOSE
#    This program will plot the temperature (annual and seasonal) and
#    the temperature anomaly (annual and seasonal) for the final 30 years
#    of the HadGEM2 simulations
#
# search for 'main program' to find end of functions
# Julia 22/11/2016



import os
import numpy as np
import scipy as sp
import matplotlib as mp
import matplotlib.pyplot as plt
from mpl_toolkits.axes_grid1 import make_axes_locatable
from netCDF4 import Dataset, MFDataset
import sys
from mpl_toolkits.basemap import Basemap, shiftgrid


#functions are:
#  def plotdata
#  def annmean
#  def seasmean

# functions start here
def plotdata(plotdata,fileno,lon,lat,titlename,minval,maxval,valinc,V,uselog,cbarname,oplot_pi,pi_temp,plio_temp):
    lons, lats = np.meshgrid(lon,lat)
    if fileno !=99:
        plt.subplot(2,2,fileno+1)

   # this is good for a tropical region
   # map=Basemap(llcrnrlon=10.0,urcrnrlon=70.0,llcrnrlat=10.0,urcrnrlat=55.0,projection='cyl',resolution='c')
   # this is good for the globe
    map=Basemap(llcrnrlon=-180.0,urcrnrlon=180.0,llcrnrlat=-90.0,urcrnrlat=90.0,projection='cyl',resolution='l')
   # this is good for the Europe
    #map=Basemap(llcrnrlon=0.0,urcrnrlon=180.0,llcrnrlat=0.0,urcrnrlat=90.0,projection='cyl',resolution='l')
    #map.drawmapboundary(fill_color='aqua')
    map.drawmapboundary
    x, y = map(lons, lats)
    map.drawcoastlines()
    if V == 0:
        V=np.arange(minval,maxval,valinc)
    if uselog =='y':
        cs = map.contourf(x,y,plotdata,V,norm=mp.colors.PowerNorm(gamma=1./3.),extend="both")
        cbar = plt.colorbar(cs,orientation="horizontal")
    else:
        if uselog =='la':
            cs = map.contourf(x,y,plotdata,V,norm=mp.colors.SymLogNorm(linthresh=2.0,linscale=2.0,vmin=-32,vmax=32),cmap='RdBu_r',extend="both")
            cbar = plt.colorbar(cs,orientation="horizontal")

        else:
            if uselog =='a':
                cs = map.contourf(x,y,plotdata,V,cmap='RdBu_r',extend="both")
                cbar = plt.colorbar(cs,orientation="horizontal")
            else:
                print(np.shape(plotdata))
                #cmap='afmhot_r'
                cmap='Reds'
                cs = map.contourf(x,y,plotdata,V,cmap=cmap,extend="both")
                cbar = plt.colorbar(cs,orientation="horizontal")
                if oplot_pi == 'y':
                    map.contour(x,y,pi_temp,[0],colors='lime',linestyles=[':'],linewidth=10) 
                    map.contour(x,y,plio_temp,[0],colors='aqua',linestyles=['--'],linewidth=10)
  

    if fileno != 99:
        plt.title(titlename)
        cbar.set_label(cbarname,labelpad=-40)
    else:
        cbar.set_label(cbarname,labelpad=-70,size=20)
        cbar.ax.tick_params(labelsize=20)
        plt.title(titlename,loc='left',fontsize=20)
  
#end def plotdata

def annmean(switch,HadCM3):
    # switch is a dummy variable to allow the program to be called
    #==============
    # preindustrial


    if HadCM3 == 'y':
        f=MFDataset('/nfs/hera1/earjcti/um/netcdf/xiboi_netcdf/xiboia@pdy[7-9]*.nc')
        lat = f.variables['latitude'][:]
        lon = f.variables['longitude'][:]
        atemp=f.variables['temp'][:]
        titlePI='PI-TAnn_HadCM3'
        titlediff='Plio - PI Tanom_HadCM3'
    else:
    # read in data from multiple files
        f=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvje/temp_data/xkvjea@pdn[7-9]*.nc')
        lat = f.variables['latitude'][:]
        lon = f.variables['longitude'][:]
        atemp=f.variables['temp_1'][:]
        titlePI='PI-TAnn_HadGEM2'
        titlediff='Plio - PI Tanom_HadGEM2'

    

    atemp=np.squeeze(atemp)
    ntimes,ny,nx=np.shape(atemp)
    print(ntimes,ny,nx)
    
#average across the time dimension
    pi_temp_ann=np.mean(atemp,axis=0)
    print('new shape',np.shape(pi_temp_ann))
    
    
    plt.figure(0)
    degC=u'\N{DEGREE SIGN}'+'C'
    lontemp=lon
    pi_temp_ann,lon = shiftgrid(180.,pi_temp_ann,lon,start=False)
    
    plotdata(pi_temp_ann-273.15,0,lon,lat,titlePI,-50,50,5.0,0.0,'n',degC,'n',0,0)


     #==============
     # Pliocene

    if HadCM3 == 'y':
        f=MFDataset('/nfs/hera1/earjcti/um/netcdf/xibol_netcdf/xibola@pdy[7-9]*.nc')
        lat = f.variables['latitude'][:]
        lon = f.variables['longitude'][:]
        atemp=f.variables['temp'][:]
        titlePlio='Plio-TAnn_HadCM3'

    else:
        f=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjf/temp_data/xkvjfa@pdn[7-9]*.nc')
        atemp=f.variables['temp_1'][:]
        titlePlio='Plio-TAnn_HadGEM2'


    atemp=np.squeeze(atemp)
    ntimes,ny,nx=np.shape(atemp)
    print(ntimes,ny,nx)

    plio_temp_ann=np.mean(atemp,axis=0)
    print('new shape plio',np.shape(plio_temp_ann))

    lon=lontemp
    plio_temp_ann,lon = shiftgrid(180.,plio_temp_ann,lon,start=False)

    plotdata(plio_temp_ann-273.15,1,lon,lat,titlePlio,-50,50,5.0,0.0,'n',degC,'n',0,0)


     #==============
     # Pliocene+2

    if HadCM3 != 'y':
        # read in data from multiple files
        f=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjg/temp_data/xkvjga@pdn[7-9]*.nc')
        atemp=f.variables['temp_1'][:]
        atemp=np.squeeze(atemp)
        ntimes,ny,nx=np.shape(atemp)
        print(ntimes,ny,nx)
        
    #average across the time dimension
        plio_tempp2_ann=np.mean(atemp,axis=0)
        print('new shape plio',np.shape(plio_tempp2_ann))
        lon=lontemp
        plio_tempp2_ann,lon = shiftgrid(180.,plio_tempp2_ann,lon,start=False)




    # Pliocene - preindustrial

    plio_anom=plio_temp_ann-pi_temp_ann

    #V=[-32,-16,-8,-4,-2,-1,-0.5,0,0.5,1,2,4,8,16,32]
    plotdata(plio_anom,2,lon,lat,titlediff,0,10,1.0,0,'n',degC,'n',0,0)
    
    # Pliocene+2 - preindustrial

    if HadCM3 != 'y':
        pliop2_anom=plio_tempp2_ann-pi_temp_ann
        #V=[-32,-16,-8,-4,-2,-1,-0.5,0,0.5,1,2,4,8,16,32]
        plotdata(pliop2_anom,3,lon,lat,'PlioP2 - PI Tanom_HG2',0,10,1.0,0,'n',degC,'n',0,0)


    if HadCM3 == 'y':
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_anom_HadCM3.eps' 
        plt.savefig(fileout, bbox_inches='tight')  
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_anom_HadCM3.tiff' 
        plt.savefig(fileout, bbox_inches='tight')  


    else:
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_anom.eps' 
        plt.savefig(fileout, bbox_inches='tight')  
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_anom.tiff' 
        plt.savefig(fileout, bbox_inches='tight')  


    
    plt.close()

  
     # get land mask and put on correct grid

    if HadCM3 != 'y':
        fm=Dataset('/nfs/hera1/earjcti/um/HadGEM_ancils/qrparm.mask.nc')
    else:
        fm=Dataset('/nfs/hera2/apps/metadata/ancil/preind2/qrparm.mask.nc')
    lsmlon=fm.variables['longitude'][:]
    lsmlat=fm.variables['latitude'][:]
    lsm=fm.variables['lsm'][:]
    lsm=np.squeeze(lsm)
    lsm,lsmlon = shiftgrid(180.,lsm,lsmlon,start=False)
    fm.close()

   

    if (np.array_equal(lsmlon,lon)) and (np.array_equal(lsmlat,lat)):
        anom_land=plio_anom / lsm
        anom_sea=plio_anom / np.abs(lsm-1.0)
    else:
        print('error lon/lat of land sea mask dont match')
        anom_land=plio_anom * lsm
        plotdata(anom_land,99,lon,lat,'a) mPWP temperature anomaly',0,10,1.0,V,'i',degC,'n',0,0)
        plt.show()
        sys.exit()



    # print temperature changes
    # create weighting array
    weightarr=np.zeros(np.shape(anom_sea))
    for i in range(0,len(lon)):
        weightarr[:,i]=np.cos(np.deg2rad(lat))

    print('mean anom_sea',np.average(plio_anom,weights=weightarr * np.abs(lsm-1.0)))
    print('mean anom_land',np.average(plio_anom,weights=weightarr*lsm))
    print('allmean',np.average(plio_anom,weights=weightarr))


    # plot temperature change by latitude    

    lat_avg_diff=np.average(plio_anom,axis=1)
    print(lat_avg_diff)
    print(np.shape(lat_avg_diff))
    allavg=np.average(lat_avg_diff,weights=np.cos(np.deg2rad(lat)))
    plt.plot(lat,lat_avg_diff)
    

    # find temperature change poleward of 60deg
    nhsum=0.
    nhsum_weights=0.
    shsum=0.
    shsum_weights=0.
    for j in range(0,len(lat)):
        if lat[j] >= 60:
            print(lat[j],lat_avg_diff[j])
            nhsum=nhsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            nhsum_weights=nhsum_weights+(np.cos(np.deg2rad(lat[j])))
        if lat[j] <= -60:
            shsum=shsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            shsum_weights=shsum_weights+(np.cos(np.deg2rad(lat[j])))
    print('nh t change poleward 60N=',nhsum/nhsum_weights)
    print('sh t change poleward 60S=',shsum/shsum_weights)

 # find temperature change poleward of 75deg
    nhsum=0.
    nhsum_weights=0.
    shsum=0.
    shsum_weights=0.
    for j in range(0,len(lat)):
        if lat[j] >= 75:
            print(lat[j],lat_avg_diff[j])
            nhsum=nhsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            nhsum_weights=nhsum_weights+(np.cos(np.deg2rad(lat[j])))
        if lat[j] <= -75:
            shsum=shsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            shsum_weights=shsum_weights+(np.cos(np.deg2rad(lat[j])))
    print('nh t change poleward 75N=',nhsum/nhsum_weights)
    print('sh t change poleward 75S=',shsum/shsum_weights)
    


#end def annmean


def seasmean(m1,m2,m3,figureno,seasname,HadCM3):
    # m1 m2 m3 are the month neames needed to reproduce the seasonal mean
    #==============
    # preindustrial

   
    if HadCM3 == 'y':
        fa=MFDataset('/nfs/hera1/earjcti/um/netcdf/xiboi_netcdf/xiboia@pdy[7-9]*'+m1+'.nc')
        fb=MFDataset('/nfs/hera1/earjcti/um/netcdf/xiboi_netcdf/xiboia@pdy[7-9]*'+m2+'.nc')
        fc=MFDataset('/nfs/hera1/earjcti/um/netcdf/xiboi_netcdf/xiboia@pdy[7-9]*'+m3+'.nc')
        tempname='temp'
        titlePI='PI-TAnn_HadCM3'
        titlediff='Plio - PI Tanom_HadCM3'
    else:
   
        # read in data from multiple files
        fa=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvje/temp_data/xkvjea@pdn[7-9]*'+m1+'_temp.nc')
        fb=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvje/temp_data/xkvjea@pdn[7-9]*'+m2+'_temp.nc')
        fc=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvje/temp_data/xkvjea@pdn[7-9]*'+m3+'_temp.nc')
        tempname='temp_1'
        titlePI='PI-TAnn_HadGEM2'
        titlediff='Plio - PI Tanom_HadGEM2'


    lat = fa.variables['latitude'][:]
    lon = fa.variables['longitude'][:]
    atemp=fa.variables[tempname][:]
    btemp=fb.variables[tempname][:]
    ctemp=fc.variables[tempname][:]
    atemp=np.squeeze(atemp)
    btemp=np.squeeze(btemp)
    ctemp=np.squeeze(ctemp)
    ntimes,ny,nx=np.shape(atemp)
    
#average across the time dimension
    pi_atemp_avg=np.mean(atemp,axis=0)
    pi_btemp_avg=np.mean(btemp,axis=0)
    pi_ctemp_avg=np.mean(ctemp,axis=0)
    
    pi_seastemp=np.mean((pi_atemp_avg,pi_btemp_avg,pi_ctemp_avg),axis=0)
    print('seastemp',np.shape(pi_seastemp))
    
    
    degC=u'\N{DEGREE SIGN}'+'C'
    
    lontemp=lon
    pi_seastemp,lon = shiftgrid(180.,pi_seastemp,lon,start=False)

    lon=lontemp
    pi_atemp_avg,lon = shiftgrid(180.,pi_atemp_avg,lon,start=False)
    
    plotdata(pi_seastemp-273.15,0,lon,lat,titlePI+seasname,-20,21,1.0,0.0,'a',degC,'n',0,0)

  
    
     #==============
     # Pliocene

    if HadCM3 == 'y':
        fa=MFDataset('/nfs/hera1/earjcti/um/netcdf/xibol_netcdf/xibola@pdy[7-9]*'+m1+'.nc')
        fb=MFDataset('/nfs/hera1/earjcti/um/netcdf/xibol_netcdf/xibola@pdy[7-9]*'+m2+'.nc')
        fc=MFDataset('/nfs/hera1/earjcti/um/netcdf/xibol_netcdf/xibola@pdy[7-9]*'+m3+'.nc')
        tempname='temp'
        titlePlio='Plio-TAnn_HadCM3'
    else:
   
        fa=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjf/temp_data/xkvjfa@pdn[7-9]*'+m1+'_temp.nc')
        fb=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjf/temp_data/xkvjfa@pdn[7-9]*'+m2+'_temp.nc')
        fc=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjf/temp_data/xkvjfa@pdn[7-9]*'+m3+'_temp.nc')
        tempname='temp_1'
        titlePlio='Plio-TAnn_HadGEM2'
 
    atemp=fa.variables[tempname][:]
    btemp=fb.variables[tempname][:]
    ctemp=fc.variables[tempname][:]
    atemp=np.squeeze(atemp)
    btemp=np.squeeze(btemp)
    ctemp=np.squeeze(ctemp)

    # average across the time dimension    
    plio_atemp_avg=np.mean(atemp,axis=0)
    plio_btemp_avg=np.mean(btemp,axis=0)
    plio_ctemp_avg=np.mean(ctemp,axis=0)
    
    plio_seastemp=np.mean((plio_atemp_avg,plio_btemp_avg,plio_ctemp_avg),axis=0)
    print('seastemp',np.shape(plio_seastemp))

    lon=lontemp
    plio_seastemp,lon = shiftgrid(180.,plio_seastemp,lon,start=False)
    
    if HadCM3 != 'y':
        plotdata(plio_seastemp-273.15,1,lon,lat,titlePlio+seasname,-20,21,1.0,0.0,'a',degC,'n',0,0)
    
    
  

     #==============
     # Pliocene+2

    if HadCM3 !='y':
        fa=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjg/temp_data/xkvjga@pdn[7-9]*'+m1+'_temp.nc')
        fb=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjg/temp_data/xkvjga@pdn[7-9]*'+m2+'_temp.nc')
        fc=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjg/temp_data/xkvjga@pdn[7-9]*'+m3+'_temp.nc')
        atemp=fa.variables['temp_1'][:]
        btemp=fb.variables['temp_1'][:]
        ctemp=fc.variables['temp_1'][:]
        atemp=np.squeeze(atemp)
        btemp=np.squeeze(btemp)
        ctemp=np.squeeze(ctemp)
        
        pliop2_atemp_avg=np.mean(atemp,axis=0)
        pliop2_btemp_avg=np.mean(btemp,axis=0)
        pliop2_ctemp_avg=np.mean(ctemp,axis=0)
        
        pliop2_seastemp=np.mean((pliop2_atemp_avg,pliop2_btemp_avg,pliop2_ctemp_avg),axis=0)
        print('seastemp',np.shape(pliop2_seastemp))
        
        lon=lontemp
        pliop2_seastemp,lon = shiftgrid(180.,pliop2_seastemp,lon,start=False)
  
        plotdata(pliop2_seastemp-273.15,1,lon,lat,titlePlio+seasname,-20,21,1.0,0.0,'a',degC,'n',0,0)
    
 

    # Pliocene - preindustrial

    plio_anom=plio_seastemp-pi_seastemp
    #V=[-32,-16,-8,-4,-2,-1,-0.5,0,0.5,1,2,4,8,16,32]
    V=0
    plotdata(plio_anom,2,lon,lat,titlediff+seasname,-10,10,3.0,V,'a',degC,'n',0,0)
    
    # Pliocene+2 - preindustrial

    if HadCM3 !='y':
        pliop2_anom=pliop2_seastemp-pi_seastemp
        V=[-32,-16,-8,-4,-2,-1,-0.5,0,0.5,1,2,4,8,16,32]
        plotdata(pliop2_anom,3,lon,lat,'PlioP2 - PI Tanom_HG2',-10,10,1.0,V,'a',degC,'n',0,0)



    if HadCM3 == 'y':
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_'+seasname+'anom_HadCM3.eps' 
        plt.savefig(fileout, bbox_inches='tight')  
        
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_'+seasname+'anom_HadCM3.tiff' 
        plt.savefig(fileout, bbox_inches='tight')  

    else:
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_'+seasname+'anom.eps' 
        plt.savefig(fileout, bbox_inches='tight')  
        
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_'+seasname+'anom.tiff' 
        plt.savefig(fileout, bbox_inches='tight')  

    plt.close()
    plt.figure(1)

    # do figure for paper
    
    if seasname=='DJF': seasname_plus='a) DJF'
    if seasname=='MAM': seasname_plus='b) MAM'
    if seasname=='JJA': seasname_plus='c) JJA'
    if seasname=='SON': seasname_plus='d) SON'
    if HadCM3 =='n':
        plotdata(pliop2_anom,99,lon,lat,seasname_plus,0,15,1.0,0,'n',degC,'y',pi_seastemp-273.15,pliop2_seastemp-273.15)
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_anom_only_'+seasname+'xkvjg.eps' 
        plt.savefig(fileout, bbox_inches='tight')  
        
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_anom_only'+seasname+'xkvjg.png' 
        plt.savefig(fileout, bbox_inches='tight')  

    else:
        plotdata(plio_anom,99,lon,lat,seasname,0,15,1.0,0,'n',degC,'y',pi_seastemp-273.15,plio_seastemp-273.15)
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_anom_only_'+seasname+'xibol.eps' 
        plt.savefig(fileout, bbox_inches='tight')  
        
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_anom_only_'+seasname+'xibol.png' 
        plt.savefig(fileout, bbox_inches='tight')  

    plt.close()
   


    # set up for writing out averages
    # get land mask and put on correct grid

    if HadCM3 != 'y':
        fm=Dataset('/nfs/hera1/earjcti/um/HadGEM_ancils/qrparm.mask.nc')
    else:
        fm=Dataset('/nfs/hera2/apps/metadata/ancil/preind2/qrparm.mask.nc')
    lsmlon=fm.variables['longitude'][:]
    lsmlat=fm.variables['latitude'][:]
    lsm=fm.variables['lsm'][:]
    lsm=np.squeeze(lsm)
    lsm,lsmlon = shiftgrid(180.,lsm,lsmlon,start=False)
    fm.close()

   

    if (np.array_equal(lsmlon,lon)) and (np.array_equal(lsmlat,lat)):
        anom_land=plio_anom / lsm
        anom_sea=plio_anom / np.abs(lsm-1.0)
    else:
        print('error lon/lat of land sea mask dont match')
        anom_land=plio_anom * lsm
        plotdata(anom_land,99,lon,lat,'a) mPWP temperature anomaly',0,10,1.0,V,'i',degC,'n',0,0)
        plt.show()
        sys.exit()



    # print temperature changes
    # create weighting array
    weightarr=np.zeros(np.shape(anom_sea))
    for i in range(0,len(lon)):
        weightarr[:,i]=np.cos(np.deg2rad(lat))

    print(seasname)
    print('mean anom_sea',np.average(plio_anom,weights=weightarr * np.abs(lsm-1.0)))
    print('mean anom_land',np.average(plio_anom,weights=weightarr*lsm))
    print('allmean',np.average(plio_anom,weights=weightarr))


    # plot temperature change by latitude    

    lat_avg_diff=np.average(plio_anom,axis=1)
    allavg=np.average(lat_avg_diff,weights=np.cos(np.deg2rad(lat)))
    plt.plot(lat,lat_avg_diff)
    

    # find temperature change poleward of 60deg
    nhsum=0.
    nhsum_weights=0.
    shsum=0.
    shsum_weights=0.
    for j in range(0,len(lat)):
        if lat[j] >= 60:
            nhsum=nhsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            nhsum_weights=nhsum_weights+(np.cos(np.deg2rad(lat[j])))
        if lat[j] <= -60:
            shsum=shsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            shsum_weights=shsum_weights+(np.cos(np.deg2rad(lat[j])))
    print('nh t change poleward 60N=',nhsum/nhsum_weights)
    print('sh t change poleward 60S=',shsum/shsum_weights)

    # find temperature change poleward of 75deg
    nhsum=0.
    nhsum_weights=0.
    shsum=0.
    shsum_weights=0.
    for j in range(0,len(lat)):
        if lat[j] >= 75:
            nhsum=nhsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            nhsum_weights=nhsum_weights+(np.cos(np.deg2rad(lat[j])))
        if lat[j] <= -75:
            shsum=shsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            shsum_weights=shsum_weights+(np.cos(np.deg2rad(lat[j])))
    print('nh t change poleward 75N=',nhsum/nhsum_weights)
    print('sh t change poleward 75S=',shsum/shsum_weights)
    



#end def seasmean


def temp_chg_by_latitude(HadCM3):

    #==============
    # preindustrial

    if HadCM3 == 'y':
        f=MFDataset('/nfs/hera1/earjcti/um/netcdf/xiboi_netcdf/xiboia@pdy[5-9]*.nc')
        lat = f.variables['latitude'][:]
        lon = f.variables['longitude'][:]
        atemp=f.variables['temp'][:]
    else:
    # read in data from multiple files
        f=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvje/temp_data/xkvjea@pdn[5-9]*.nc')
        lat = f.variables['latitude'][:]
        lon = f.variables['longitude'][:]
        atemp=f.variables['temp_1'][:]
    
    f.close()
    atemp=np.squeeze(atemp)
    ntimes,ny,nx=np.shape(atemp)
    print(ntimes,ny,nx)
    
#average across the time dimension and the latitude dimension
    pi_temp_ann=np.mean(atemp,axis=0)
    pi_temp_lat_ann=np.mean(pi_temp_ann,axis=1)
    print('new shape pi',np.shape(pi_temp_lat_ann))
    
     #==============
     # Pliocene

    if HadCM3 == 'y':
        f=MFDataset('/nfs/hera1/earjcti/um/netcdf/xibol_netcdf/xibola@pdy[5-9]*.nc')
        lat = f.variables['latitude'][:]
        lon = f.variables['longitude'][:]
        atemp=f.variables['temp'][:]

    else:
        f=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjf/temp_data/xkvjfa@pdn[5-9]*.nc')
        atemp=f.variables['temp_1'][:]

    f.close()
    atemp=np.squeeze(atemp)
    ntimes,ny,nx=np.shape(atemp)

    plio_temp_ann=np.mean(atemp,axis=0)
    plio_temp_lat_ann=np.mean(plio_temp_ann,axis=1)
    print('new shape plio',np.shape(pi_temp_lat_ann))


     #==============
     # Pliocene+2

    if HadCM3 != 'y':
        # read in data from multiple files
        f=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjg/temp_data/xkvjga@pdn[5-9]*.nc')
        atemp=f.variables['temp_1'][:]
        atemp=np.squeeze(atemp)
        ntimes,ny,nx=np.shape(atemp)
        print(ntimes,ny,nx)
        
    #average across the time dimension
        plio_tempp2_ann=np.mean(atemp,axis=0)
        plio_tempp2_lat_ann=np.mean(plio_tempp2_ann,axis=1)
        f.close()


    # Pliocene - preindustrial

    plio_anom=plio_temp_lat_ann-pi_temp_lat_ann

    # Pliocene+2 - preindustrial

    if HadCM3 != 'y':
        pliop2_anom=plio_tempp2_lat_ann-pi_temp_lat_ann


    if HadCM3 == 'y':
        allanom=[lat,plio_anom]
        return allanom
    else:
        allanom=[lat,plio_anom,pliop2_anom]
        return allanom
    
    



#end def temp_chg_by_latitude


################################
# main program

# annual mean
figureno=0

HadCM3='y'

#plt.figure(figureno)
#annmean('y',HadCM3)
#figureno=figureno+1

#djf mean
#plt.figure(figureno)
seasmean('dc','ja','fb',figureno,'DJF',HadCM3)
#figureno=figureno+1

#mam mean
#plt.figure(figureno)
seasmean('mr','ar','my',figureno,'MAM',HadCM3)
#figureno=figureno+1

#jja mean
#plt.figure(figureno)
seasmean('jn','jl','ag',figureno,'JJA',HadCM3)
##figureno=figureno+1

#son mean
#plt.figure(figureno)
seasmean('sp','ot','nv',figureno,'SON',HadCM3)
#figureno=figureno+1

# to see what the polar amplification is
#HadCM3='y'
#temp_ret=temp_chg_by_latitude(HadCM3)
#lats_HadCM3=temp_ret[0]
#temp_anom_HadCM3=temp_ret[1]
#plt.plot(temp_anom_HadCM3,lats_HadCM3)

#HadCM3='n'
#temp_ret=temp_chg_by_latitude(HadCM3)
#lats_HadGEM=temp_ret[0]
#temp_anom_HadGEM=temp_ret[1]
#temp_anom_HadGEMp2=temp_ret[2]

#mp.rcParams.update({'font.size':15})
#plt.plot(temp_anom_HadGEMp2,lats_HadGEM,'g',label='HadGEM2')
#plt.plot(temp_anom_HadCM3,lats_HadCM3,'r',label='HadCM3')
#plt.plot(temp_anom_HadGEM,lats_HadGEM,'b')

#degC=u'\N{DEGREE SIGN}'+'C'
#plt.xlabel(degC,fontsize=20)
#plt.ylabel('latitude',fontsize=20)
#plt.title('c) mPWP - preindustrial temp anom',loc='left',fontsize=25)
#axes=plt.gca()
#axes.set_xlim(xmin=0,xmax=12)#
#axes.set_ylim([-80,80])
#legend=plt.legend(loc='center right')
#fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_polar_amp.eps' 
#plt.savefig(fileout, bbox_inches='tight')  



sys.exit(0)

####

