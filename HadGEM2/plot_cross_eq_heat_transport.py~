#!/usr/bin/env python2.7
#NAME
#    PLOT_cross_eq_heat_transport.py
#PURPOSE
#    This program is wanting to find out more about the movement of the 
#    ITCZ and so initially wants to find out whether the NH is warming more
#    than the southern hemisphere, or vice versa.  It will then look at the 
#    cross equatorial heat transport
#
# search for 'main program' to find end of functions
# Julia 1/11/2018



import os
import numpy as np
import scipy as sp
import matplotlib as mp
import matplotlib.pyplot as plt
from mpl_toolkits.axes_grid1 import make_axes_locatable
from netCDF4 import Dataset, MFDataset
import sys
from mpl_toolkits.basemap import Basemap, shiftgrid


#functions are:
#  def plotdata
#  def annmean
#  def seasmean

# functions start here
def plotdata(plotdata,fileno,lon,lat,titlename,minval,maxval,valinc,V,uselog,cbarname):
    lons, lats = np.meshgrid(lon,lat)
    plt.subplot(2,2,fileno+1)

   # this is good for a tropical region
   # map=Basemap(llcrnrlon=10.0,urcrnrlon=70.0,llcrnrlat=10.0,urcrnrlat=55.0,projection='cyl',resolution='c')
   # this is good for the globe
    map=Basemap(llcrnrlon=-180.0,urcrnrlon=180.0,llcrnrlat=-90.0,urcrnrlat=90.0,projection='cyl',resolution='l')
    #map.drawmapboundary(fill_color='aqua')
    map.drawmapboundary
    x, y = map(lons, lats)
    map.drawcoastlines()
    if V == 0:
        V=np.arange(minval,maxval,valinc)
    if uselog =='y':
        cs = map.contourf(x,y,plotdata,V,norm=mp.colors.PowerNorm(gamma=1./3.),extend="both")
        cbar = plt.colorbar(cs,orientation="horizontal")
    else:
        if uselog =='la':
            cs = map.contourf(x,y,plotdata,V,norm=mp.colors.SymLogNorm(linthresh=2.0,linscale=2.0,vmin=-32,vmax=32),cmap='RdBu_r',extend="both")
            cbar = plt.colorbar(cs,orientation="horizontal")

        else:
            if uselog =='a':
                cs = map.contourf(x,y,plotdata,V,cmap='RdBu_r',extend="both")
                cbar = plt.colorbar(cs,orientation="horizontal")
            else:
                print(np.shape(plotdata))
                cs = map.contourf(x,y,plotdata,V,extend="both")
                cbar = plt.colorbar(cs,orientation="horizontal",)

    plt.title(titlename)
    cbar.set_label(cbarname,labelpad=-40)
#end def plotdata

#######################################################
def interhem_tdiff(mPWP_expt,pi_expt,extra,HadCM3):
# this will get the interhemispheric temperature differences by month

    #==============
    # get all data

    if HadCM3 == 'y':
        filestart_pi='/nfs/hera1/earjcti/um/netcdf/'+pi_expt+'_netcdf/'+pi_expt+'a@pd'+extra+'[7-9]*'
        filestart_plio='/nfs/hera1/earjcti/um/netcdf/'+pi_expt+'_netcdf/'+pi_expt+'a@pd'+extra+'[7-9]*'
        fieldname='temp'
        suffix='.nc'
    else:
        filestart_pi='/nfs/hera1/earjcti/um/HadGEM_data/'+mPWP_expt+'/temp_data/'+mPWP_expt+'a@pd'+extra+'[7-9]*'
        filestart_plio='/nfs/hera1/earjcti/um/HadGEM_data/'+mPWP_expt+'/temp_data/'+mPWP_expt+'a@pd'+extra+'[7-9]*'
        fieldname='temp_1'
        suffix='_temp.nc'

    monthnames=['ja','fb','mr','ar','my','jn','jl','ag','sp','ot','nv','dc']
    nmon=len(monthnames)

    for month in range(0,nmon):
        # get preindustrial data (average monthly temperature over globe)
        f=MFDataset(filestart_pi+monthnames[month]+suffix)
        lat = f.variables['latitude'][:]
        lon = f.variables['longitude'][:]
        atemp=f.variables[fieldname][:]
        atemp=np.squeeze(atemp)
        temp_avg=np.mean(atemp,axis=0)
        ny,nx=np.shape(temp_avg)
        if month==0:
            temp_pi=np.zeros((nmon,ny,nx))
        temp_pi[month,:,:]=temp_avg
    
        # get mPWP data (average monthly temperature over globe)
        f=MFDataset(filestart_plio+monthnames[month]+suffix)
        lat = f.variables['latitude'][:]
        lon = f.variables['longitude'][:]
        atemp=f.variables[fieldname][:]
        atemp=np.squeeze(atemp)
        temp_avg=np.mean(atemp,axis=0)
        ny,nx=np.shape(temp_avg)
        if month==0:
            temp_plio=np.zeros((nmon,ny,nx))
        temp_plio[month,:,:]=temp_avg


    ###########################################################
    # get the average NH and SH temperature for each month

    # create weighting array for the NH and the SH
    nh_weights=np.zeros((ny,nx))
    sh_weights=np.zeros((ny,nx))
   
    for i in range(0,nx):
        nh_weights[:,i]=np.cos(np.deg2rad(lat))
        sh_weights[:,i]=np.cos(np.deg2rad(lat))

    for j in range(0,ny):
        if lat[j] < 0:
            nh_weights[j,:]=0.0
        if lat[j] > 0:
            sh_weights[j,:]=0.0

    nh_plio=np.zeros(nmon)
    nh_pi=np.zeros(nmon)
    sh_plio=np.zeros(nmon)
    sh_pi=np.zeros(nmon)

    for mon in range(0,nmon):
        nh_plio[mon]=np.average(temp_plio[mon,:,:],weights=nh_weights)
        nh_pi[mon]=np.average(temp_pi[mon,:,:],weights=nh_weights)
        sh_plio[mon]=np.average(temp_plio[mon,:,:],weights=sh_weights)
        sh_pi[mon]=np.average(temp_pi[mon,:,:],weights=sh_weights)
                        

    plt.plot(nh_plio,label='nh_plio')
    plt.plot(sh_plio,label='sh_plio')
    plt.plot(nh_pi,label='nh_pi')
    plt.plot(sh_pi,label='sh_pi')
    plt.legend()
    plt.show()
    sys.exit()

    print(seasname)
    print('mean anom_sea',np.average(plio_anom,weights=weightarr * np.abs(lsm-1.0)))
    print('mean anom_land',np.average(plio_anom,weights=weightarr*lsm))
    print('allmean',np.average(plio_anom,weights=weightarr))


    # plot temperature change by latitude    

    lat_avg_diff=np.average(plio_anom,axis=1)
    allavg=np.average(lat_avg_diff,weights=np.cos(np.deg2rad(lat)))
    plt.plot(lat,lat_avg_diff)
    

        
    
#average across the time dimension
    pi_temp_ann=np.mean(atemp,axis=0)
    print('new shape',np.shape(pi_temp_ann))
    
    
    plt.figure(0)
    degC=u'\N{DEGREE SIGN}'+'C'
    lontemp=lon
    pi_temp_ann,lon = shiftgrid(180.,pi_temp_ann,lon,start=False)
    
    plotdata(pi_temp_ann-273.15,0,lon,lat,titlePI,-50,50,5.0,0.0,'n',degC)


     #==============
     # Pliocene

    if HadCM3 == 'y':
        f=MFDataset('/nfs/hera1/earjcti/um/netcdf/xibol_netcdf/xibola@pdy[7-9]*.nc')
        lat = f.variables['latitude'][:]
        lon = f.variables['longitude'][:]
        atemp=f.variables['temp'][:]
        titlePlio='Plio-TAnn_HadCM3'

    else:
        f=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjf/temp_data/xkvjfa@pdn[7-9]*.nc')
        atemp=f.variables['temp_1'][:]
        titlePlio='Plio-TAnn_HadGEM2'


    atemp=np.squeeze(atemp)
    ntimes,ny,nx=np.shape(atemp)
    print(ntimes,ny,nx)

    plio_temp_ann=np.mean(atemp,axis=0)
    print('new shape plio',np.shape(plio_temp_ann))

    lon=lontemp
    plio_temp_ann,lon = shiftgrid(180.,plio_temp_ann,lon,start=False)

    plotdata(plio_temp_ann-273.15,1,lon,lat,titlePlio,-50,50,5.0,0.0,'n',degC)


     #==============
     # Pliocene+2

    if HadCM3 != 'y':
        # read in data from multiple files
        f=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjg/temp_data/xkvjga@pdn[7-9]*.nc')
        atemp=f.variables['temp_1'][:]
        atemp=np.squeeze(atemp)
        ntimes,ny,nx=np.shape(atemp)
        print(ntimes,ny,nx)
        
    #average across the time dimension
        plio_tempp2_ann=np.mean(atemp,axis=0)
        print('new shape plio',np.shape(plio_tempp2_ann))
        lon=lontemp
        plio_tempp2_ann,lon = shiftgrid(180.,plio_tempp2_ann,lon,start=False)




    # Pliocene - preindustrial

    plio_anom=plio_temp_ann-pi_temp_ann

    #V=[-32,-16,-8,-4,-2,-1,-0.5,0,0.5,1,2,4,8,16,32]
    plotdata(plio_anom,2,lon,lat,titlediff,0,10,1.0,0,'n',degC)
    
    # Pliocene+2 - preindustrial

    if HadCM3 != 'y':
        pliop2_anom=plio_tempp2_ann-pi_temp_ann
        #V=[-32,-16,-8,-4,-2,-1,-0.5,0,0.5,1,2,4,8,16,32]
        plotdata(pliop2_anom,3,lon,lat,'PlioP2 - PI Tanom_HG2',0,10,1.0,0,'n',degC)


    if HadCM3 == 'y':
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_anom_HadCM3.eps' 
        plt.savefig(fileout, bbox_inches='tight')  
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_anom_HadCM3.tiff' 
        plt.savefig(fileout, bbox_inches='tight')  


    else:
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_anom.eps' 
        plt.savefig(fileout, bbox_inches='tight')  
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_anom.tiff' 
        plt.savefig(fileout, bbox_inches='tight')  


    
    plt.close()


     # get land mask and put on correct grid

    if HadCM3 != 'y':
        fm=Dataset('/nfs/hera1/earjcti/um/HadGEM_ancils/qrparm.mask.nc')
    else:
        fm=Dataset('/nfs/hera2/apps/metadata/ancil/preind2/qrparm.mask.nc')
    lsmlon=fm.variables['longitude'][:]
    lsmlat=fm.variables['latitude'][:]
    lsm=fm.variables['lsm'][:]
    lsm=np.squeeze(lsm)
    lsm,lsmlon = shiftgrid(180.,lsm,lsmlon,start=False)
    fm.close()

   

    if (np.array_equal(lsmlon,lon)) and (np.array_equal(lsmlat,lat)):
        anom_land=plio_anom / lsm
        anom_sea=plio_anom / np.abs(lsm-1.0)
    else:
        print('error lon/lat of land sea mask dont match')
        anom_land=plio_anom * lsm
        plotdata(anom_land,99,lon,lat,'a) mPWP temperature anomaly',0,10,1.0,V,'i',degC)
        plt.show()
        sys.exit()



    # print temperature changes
    # create weighting array
    weightarr=np.zeros(np.shape(anom_sea))
    for i in range(0,len(lon)):
        weightarr[:,i]=np.cos(np.deg2rad(lat))

    print('mean anom_sea',np.average(plio_anom,weights=weightarr * np.abs(lsm-1.0)))
    print('mean anom_land',np.average(plio_anom,weights=weightarr*lsm))
    print('allmean',np.average(plio_anom,weights=weightarr))


    # plot temperature change by latitude    

    lat_avg_diff=np.average(plio_anom,axis=1)
    print(lat_avg_diff)
    print(np.shape(lat_avg_diff))
    allavg=np.average(lat_avg_diff,weights=np.cos(np.deg2rad(lat)))
    plt.plot(lat,lat_avg_diff)
    

    # find temperature change poleward of 60deg
    nhsum=0.
    nhsum_weights=0.
    shsum=0.
    shsum_weights=0.
    for j in range(0,len(lat)):
        if lat[j] >= 60:
            print(lat[j],lat_avg_diff[j])
            nhsum=nhsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            nhsum_weights=nhsum_weights+(np.cos(np.deg2rad(lat[j])))
        if lat[j] <= -60:
            shsum=shsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            shsum_weights=shsum_weights+(np.cos(np.deg2rad(lat[j])))
    print('nh t change poleward 60N=',nhsum/nhsum_weights)
    print('sh t change poleward 60S=',shsum/shsum_weights)

 # find temperature change poleward of 75deg
    nhsum=0.
    nhsum_weights=0.
    shsum=0.
    shsum_weights=0.
    for j in range(0,len(lat)):
        if lat[j] >= 75:
            print(lat[j],lat_avg_diff[j])
            nhsum=nhsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            nhsum_weights=nhsum_weights+(np.cos(np.deg2rad(lat[j])))
        if lat[j] <= -75:
            shsum=shsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            shsum_weights=shsum_weights+(np.cos(np.deg2rad(lat[j])))
    print('nh t change poleward 75N=',nhsum/nhsum_weights)
    print('sh t change poleward 75S=',shsum/shsum_weights)
    


#end def interhem_tdiff


def seasmean(m1,m2,m3,figureno,seasname,HadCM3):
    # m1 m2 m3 are the month neames needed to reproduce the seasonal mean
    #==============
    # preindustrial

   
    if HadCM3 == 'y':
        fa=MFDataset('/nfs/hera1/earjcti/um/netcdf/xiboi_netcdf/xiboia@pdy[7-9]*'+m1+'.nc')
        fb=MFDataset('/nfs/hera1/earjcti/um/netcdf/xiboi_netcdf/xiboia@pdy[7-9]*'+m2+'.nc')
        fc=MFDataset('/nfs/hera1/earjcti/um/netcdf/xiboi_netcdf/xiboia@pdy[7-9]*'+m3+'.nc')
        tempname='temp'
        titlePI='PI-TAnn_HadCM3'
        titlediff='Plio - PI Tanom_HadCM3'
    else:
   
        # read in data from multiple files
        fa=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvje/temp_data/xkvjea@pdn[7-9]*'+m1+'_temp.nc')
        fb=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvje/temp_data/xkvjea@pdn[7-9]*'+m2+'_temp.nc')
        fc=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvje/temp_data/xkvjea@pdn[7-9]*'+m3+'_temp.nc')
        tempname='temp_1'
        titlePI='PI-TAnn_HadGEM2'
        titlediff='Plio - PI Tanom_HadGEM2'


    lat = fa.variables['latitude'][:]
    lon = fa.variables['longitude'][:]
    atemp=fa.variables[tempname][:]
    btemp=fb.variables[tempname][:]
    ctemp=fc.variables[tempname][:]
    atemp=np.squeeze(atemp)
    btemp=np.squeeze(btemp)
    ctemp=np.squeeze(ctemp)
    ntimes,ny,nx=np.shape(atemp)
    
#average across the time dimension
    pi_atemp_avg=np.mean(atemp,axis=0)
    pi_btemp_avg=np.mean(btemp,axis=0)
    pi_ctemp_avg=np.mean(ctemp,axis=0)
    
    pi_seastemp=np.mean((pi_atemp_avg,pi_btemp_avg,pi_ctemp_avg),axis=0)
    print('seastemp',np.shape(pi_seastemp))
    
    
    degC=u'\N{DEGREE SIGN}'+'C'
    
    lontemp=lon
    pi_seastemp,lon = shiftgrid(180.,pi_seastemp,lon,start=False)

    lon=lontemp
    pi_atemp_avg,lon = shiftgrid(180.,pi_atemp_avg,lon,start=False)
    
    plotdata(pi_seastemp-273.15,0,lon,lat,titlePI+seasname,-50,50,5.0,0.0,'n',degC)

  
    
     #==============
     # Pliocene

    if HadCM3 == 'y':
        fa=MFDataset('/nfs/hera1/earjcti/um/netcdf/xibol_netcdf/xibola@pdy[7-9]*'+m1+'.nc')
        fb=MFDataset('/nfs/hera1/earjcti/um/netcdf/xibol_netcdf/xibola@pdy[7-9]*'+m2+'.nc')
        fc=MFDataset('/nfs/hera1/earjcti/um/netcdf/xibol_netcdf/xibola@pdy[7-9]*'+m3+'.nc')
        tempname='temp'
        titlePlio='Plio-TAnn_HadCM3'
    else:
   
        fa=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjf/temp_data/xkvjfa@pdn[7-9]*'+m1+'_temp.nc')
        fb=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjf/temp_data/xkvjfa@pdn[7-9]*'+m2+'_temp.nc')
        fc=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjf/temp_data/xkvjfa@pdn[7-9]*'+m3+'_temp.nc')
        tempname='temp_1'
        titlePlio='Plio-TAnn_HadGEM2'
 
    atemp=fa.variables[tempname][:]
    btemp=fb.variables[tempname][:]
    ctemp=fc.variables[tempname][:]
    atemp=np.squeeze(atemp)
    btemp=np.squeeze(btemp)
    ctemp=np.squeeze(ctemp)

    # average across the time dimension    
    plio_atemp_avg=np.mean(atemp,axis=0)
    plio_btemp_avg=np.mean(btemp,axis=0)
    plio_ctemp_avg=np.mean(ctemp,axis=0)
    
    plio_seastemp=np.mean((plio_atemp_avg,plio_btemp_avg,plio_ctemp_avg),axis=0)
    print('seastemp',np.shape(plio_seastemp))

    lon=lontemp
    plio_seastemp,lon = shiftgrid(180.,plio_seastemp,lon,start=False)
    
    
    plotdata(plio_seastemp-273.15,1,lon,lat,titlePlio+seasname,-50,50,5.0,0.0,'n',degC)
  

     #==============
     # Pliocene+2

    if HadCM3 !='y':
        fa=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjg/temp_data/xkvjga@pdn[7-9]*'+m1+'_temp.nc')
        fb=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjg/temp_data/xkvjga@pdn[7-9]*'+m2+'_temp.nc')
        fc=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjg/temp_data/xkvjga@pdn[7-9]*'+m3+'_temp.nc')
        atemp=fa.variables['temp_1'][:]
        btemp=fb.variables['temp_1'][:]
        ctemp=fc.variables['temp_1'][:]
        atemp=np.squeeze(atemp)
        btemp=np.squeeze(btemp)
        ctemp=np.squeeze(ctemp)
        
        pliop2_atemp_avg=np.mean(atemp,axis=0)
        pliop2_btemp_avg=np.mean(btemp,axis=0)
        pliop2_ctemp_avg=np.mean(ctemp,axis=0)
        
        pliop2_seastemp=np.mean((pliop2_atemp_avg,pliop2_btemp_avg,pliop2_ctemp_avg),axis=0)
        print('seastemp',np.shape(pliop2_seastemp))
        
        lon=lontemp
        pliop2_seastemp,lon = shiftgrid(180.,pliop2_seastemp,lon,start=False)
    
 

    # Pliocene - preindustrial

    plio_anom=plio_seastemp-pi_seastemp
    #V=[-32,-16,-8,-4,-2,-1,-0.5,0,0.5,1,2,4,8,16,32]
    V=0
    plotdata(plio_anom,2,lon,lat,titlediff+seasname,-15,15,3.0,V,'n',degC)
    
    # Pliocene+2 - preindustrial

    if HadCM3 !='y':
        pliop2_anom=pliop2_seastemp-pi_seastemp
        V=[-32,-16,-8,-4,-2,-1,-0.5,0,0.5,1,2,4,8,16,32]
        plotdata(pliop2_anom,3,lon,lat,'PlioP2 - PI Tanom_HG2',-50,50,5.0,V,'la',degC)



    if HadCM3 == 'y':
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_'+seasname+'anom_HadCM3.eps' 
        plt.savefig(fileout, bbox_inches='tight')  
        
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_'+seasname+'anom_HadCM3.tiff' 
        plt.savefig(fileout, bbox_inches='tight')  

    else:
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_'+seasname+'anom.eps' 
        plt.savefig(fileout, bbox_inches='tight')  
        
        fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_'+seasname+'anom.tiff' 
        plt.savefig(fileout, bbox_inches='tight')  

    plt.close()
    plt.figure(1)


    # set up for writing out averages
    # get land mask and put on correct grid

    if HadCM3 != 'y':
        fm=Dataset('/nfs/hera1/earjcti/um/HadGEM_ancils/qrparm.mask.nc')
    else:
        fm=Dataset('/nfs/hera2/apps/metadata/ancil/preind2/qrparm.mask.nc')
    lsmlon=fm.variables['longitude'][:]
    lsmlat=fm.variables['latitude'][:]
    lsm=fm.variables['lsm'][:]
    lsm=np.squeeze(lsm)
    lsm,lsmlon = shiftgrid(180.,lsm,lsmlon,start=False)
    fm.close()

   

    if (np.array_equal(lsmlon,lon)) and (np.array_equal(lsmlat,lat)):
        anom_land=plio_anom / lsm
        anom_sea=plio_anom / np.abs(lsm-1.0)
    else:
        print('error lon/lat of land sea mask dont match')
        anom_land=plio_anom * lsm
        plotdata(anom_land,99,lon,lat,'a) mPWP temperature anomaly',0,10,1.0,V,'i',degC)
        plt.show()
        sys.exit()



    # print temperature changes
    # create weighting array
    weightarr=np.zeros(np.shape(anom_sea))
    for i in range(0,len(lon)):
        weightarr[:,i]=np.cos(np.deg2rad(lat))

    print(seasname)
    print('mean anom_sea',np.average(plio_anom,weights=weightarr * np.abs(lsm-1.0)))
    print('mean anom_land',np.average(plio_anom,weights=weightarr*lsm))
    print('allmean',np.average(plio_anom,weights=weightarr))


    # plot temperature change by latitude    

    lat_avg_diff=np.average(plio_anom,axis=1)
    allavg=np.average(lat_avg_diff,weights=np.cos(np.deg2rad(lat)))
    plt.plot(lat,lat_avg_diff)
    

    # find temperature change poleward of 60deg
    nhsum=0.
    nhsum_weights=0.
    shsum=0.
    shsum_weights=0.
    for j in range(0,len(lat)):
        if lat[j] >= 60:
            nhsum=nhsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            nhsum_weights=nhsum_weights+(np.cos(np.deg2rad(lat[j])))
        if lat[j] <= -60:
            shsum=shsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            shsum_weights=shsum_weights+(np.cos(np.deg2rad(lat[j])))
    print('nh t change poleward 60N=',nhsum/nhsum_weights)
    print('sh t change poleward 60S=',shsum/shsum_weights)

    # find temperature change poleward of 75deg
    nhsum=0.
    nhsum_weights=0.
    shsum=0.
    shsum_weights=0.
    for j in range(0,len(lat)):
        if lat[j] >= 75:
            nhsum=nhsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            nhsum_weights=nhsum_weights+(np.cos(np.deg2rad(lat[j])))
        if lat[j] <= -75:
            shsum=shsum+(lat_avg_diff[j] * np.cos(np.deg2rad(lat[j])))
            shsum_weights=shsum_weights+(np.cos(np.deg2rad(lat[j])))
    print('nh t change poleward 75N=',nhsum/nhsum_weights)
    print('sh t change poleward 75S=',shsum/shsum_weights)
    



#end def seasmean


def temp_chg_by_latitude(HadCM3):

    #==============
    # preindustrial

    if HadCM3 == 'y':
        f=MFDataset('/nfs/hera1/earjcti/um/netcdf/xiboi_netcdf/xiboia@pdy[5-9]*.nc')
        lat = f.variables['latitude'][:]
        lon = f.variables['longitude'][:]
        atemp=f.variables['temp'][:]
    else:
    # read in data from multiple files
        f=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvje/temp_data/xkvjea@pdn[5-9]*.nc')
        lat = f.variables['latitude'][:]
        lon = f.variables['longitude'][:]
        atemp=f.variables['temp_1'][:]
    
    f.close()
    atemp=np.squeeze(atemp)
    ntimes,ny,nx=np.shape(atemp)
    print(ntimes,ny,nx)
    
#average across the time dimension and the latitude dimension
    pi_temp_ann=np.mean(atemp,axis=0)
    pi_temp_lat_ann=np.mean(pi_temp_ann,axis=1)
    print('new shape pi',np.shape(pi_temp_lat_ann))
    
     #==============
     # Pliocene

    if HadCM3 == 'y':
        f=MFDataset('/nfs/hera1/earjcti/um/netcdf/xibol_netcdf/xibola@pdy[5-9]*.nc')
        lat = f.variables['latitude'][:]
        lon = f.variables['longitude'][:]
        atemp=f.variables['temp'][:]

    else:
        f=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjf/temp_data/xkvjfa@pdn[5-9]*.nc')
        atemp=f.variables['temp_1'][:]

    f.close()
    atemp=np.squeeze(atemp)
    ntimes,ny,nx=np.shape(atemp)

    plio_temp_ann=np.mean(atemp,axis=0)
    plio_temp_lat_ann=np.mean(plio_temp_ann,axis=1)
    print('new shape plio',np.shape(pi_temp_lat_ann))


     #==============
     # Pliocene+2

    if HadCM3 != 'y':
        # read in data from multiple files
        f=MFDataset('/nfs/hera1/earjcti/um/HadGEM_data/xkvjg/temp_data/xkvjga@pdn[5-9]*.nc')
        atemp=f.variables['temp_1'][:]
        atemp=np.squeeze(atemp)
        ntimes,ny,nx=np.shape(atemp)
        print(ntimes,ny,nx)
        
    #average across the time dimension
        plio_tempp2_ann=np.mean(atemp,axis=0)
        plio_tempp2_lat_ann=np.mean(plio_tempp2_ann,axis=1)
        f.close()


    # Pliocene - preindustrial

    plio_anom=plio_temp_lat_ann-pi_temp_lat_ann

    # Pliocene+2 - preindustrial

    if HadCM3 != 'y':
        pliop2_anom=plio_tempp2_lat_ann-pi_temp_lat_ann


    if HadCM3 == 'y':
        allanom=[lat,plio_anom]
        return allanom
    else:
        allanom=[lat,plio_anom,pliop2_anom]
        return allanom
    
    



#end def temp_chg_by_latitude


################################
# main program

# annual mean
figureno=0

HadCM3='n'
mPWP_expt='xkvjg'
pi_expt='xkvje'
extra='n'
#plt.figure(figureno)
interhem_tdiff(mPWP_expt,pi_expt,extra,HadCM3)
#figureno=figureno+1

#djf mean
#plt.figure(figureno)
seasmean('dc','ja','fb',figureno,'djf',HadCM3)
#figureno=figureno+1

#mam mean
#plt.figure(figureno)
seasmean('mr','ar','my',figureno,'mam',HadCM3)
#figureno=figureno+1

#jja mean
#plt.figure(figureno)
seasmean('jn','jl','ag',figureno,'jja',HadCM3)
#figureno=figureno+1

#son mean
#plt.figure(figureno)
seasmean('sp','ot','nv',figureno,'son',HadCM3)
#figureno=figureno+1

# to see what the polar amplification is
#HadCM3='y'
#temp_ret=temp_chg_by_latitude(HadCM3)
#lats_HadCM3=temp_ret[0]
#temp_anom_HadCM3=temp_ret[1]
#plt.plot(temp_anom_HadCM3,lats_HadCM3)

#HadCM3='n'
#temp_ret=temp_chg_by_latitude(HadCM3)
#lats_HadGEM=temp_ret[0]
#temp_anom_HadGEM=temp_ret[1]
#temp_anom_HadGEMp2=temp_ret[2]

#mp.rcParams.update({'font.size':15})
#plt.plot(temp_anom_HadGEMp2,lats_HadGEM,'g',label='HadGEM2')
#plt.plot(temp_anom_HadCM3,lats_HadCM3,'r',label='HadCM3')
#plt.plot(temp_anom_HadGEM,lats_HadGEM,'b')

#degC=u'\N{DEGREE SIGN}'+'C'
#plt.xlabel(degC,fontsize=20)
#plt.ylabel('latitude',fontsize=20)
#plt.title('c) mPWP - preindustrial temp anom',loc='left',fontsize=25)
#axes=plt.gca()
#axes.set_xlim(xmin=0,xmax=12)#
#axes.set_ylim([-80,80])
#legend=plt.legend(loc='center right')
#fileout='/nfs/see-fs-02_users/earjcti/PYTHON/PLOTS/HadGEM2/plot_surftemp/MAT_polar_amp.eps' 
#plt.savefig(fileout, bbox_inches='tight')  



sys.exit(0)

####

