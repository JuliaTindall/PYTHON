#python program
#
# this program will plot multiple timeseries on the same plot
# we are starting off with SH salinity and sea ice
import matplotlib.pyplot as plt
import numpy as np
import sys

expt = 'xpsig'
fields = ['seaice_area','salinity']

# Function to read data from a file, skipping the first line
def read_data(filename):
    x_vals = []
    y_vals = []
    with open(filename, 'r') as file:
        next(file)  # Skip the title line
        for line in file:
            try:
                x, y = map(float, line.strip().split(','))
                x_vals.append(x)
                y_vals.append(y)
            except ValueError:
                print(f"Skipping invalid line in {filename}: {line.strip()}")
    return x_vals, y_vals

# Function to compute running mean**
def running_mean(data, window_size):
    return np.convolve(data, np.ones(window_size)/window_size, mode='valid')


##################################################################
plt.figure(figsize=(12, 9))
period = {'xpsid':'LP','xpsij':'LP490','xpsie':'EP400','xpsig':'EP'}
fileend = {'salinity':'_60.0S-90S','seaice_area':'_SH'}
axis_label = {'salinity':'psu','seaice_area':'km2'}
axis = {'salinity':'primary'}

#plot data from all the files
if expt == 'xpsij':
    startyear=1991
else:
    startyear=12

labels=[]
for field in fields:
    filename = (field + '_' + expt + fileend.get(field,'') + '_' + str(startyear) + '_2999.tex')
   
    x, y = read_data(filename)

    # Plot the data
    plt.subplot(211)
    ax1=plt.gca()
    ax2=ax1.twinx()

    if axis.get(field,'') == 'primary':
        ax1.plot(x, y, label=field, color='blue' )
    else:
        ax2.plot(x, y, label=field,color='orange' )
        
    plt.title(expt + ': ' +  period.get(expt))

ax1.set_xlabel('year')
ax1.set_ylabel('psu',color='blue')
ax2.set_ylabel('km2',color='orange')
lines1, labels1 = ax1.get_legend_handles_labels()
lines2, labels2 = ax2.get_legend_handles_labels()
ax1.legend(lines1 + lines2, labels1 + labels2, loc='upper left')

plt.grid(True)
plt.show()
sys.exit()

#do a 30 year running mean
for expt in exptnames:
    if expt == 'xpsij':
        filename = 'salinity_' + expt + '_60.0S-90S_1991_2999.tex'
    else:
        filename = 'salinity_' + expt + '_60.0S-90S_12_2999.tex'
  
    x, y = read_data(filename)
    window=30
    y_mean=running_mean(y,window)
    x_mean=x[window-1:]

    # Plot the data
    plt.subplot(212)
    plt.plot(x_mean, y_mean, label=expt + ': ' + period.get(expt) )
    plt.title('SSS 60S-90S (30 year running mean)')

plt.xlabel('year')
plt.ylabel('psu')
plt.legend()
plt.grid(True)


# Save the plot to a file
plt.savefig('salinity.png')
print("Plot saved to 'combined_plot.png'.")
